<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>pinterest-responsive-layout</title>
    <meta name="description" content="responsive design based CSS layout similar to pinterest.com">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/jquery.tagit.css" />
    <link href="css/tagit.ui-zendesk.css" rel="stylesheet" />
    <!--<link rel="stylesheet" href="css/normalize.css">-->
    <link rel="stylesheet" href="css/main.css">
    <script src="js/vendor/modernizr-2.6.2.min.js"></script>
    <script src="js/vendor/handlebars-v2.0.0.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
    <!--[if lt IE 7]>
        <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
    <!-- Header -->
    <nav id="nav" class="navbar navbar-default"></nav>

    <!-- Content -->
    <div class="container-fluid">
        <div class="row">
            <!-- Main -->
            <div id="main" class="col-lg-10 main">
                <div id="list" class="grid-wrapper"></div>
            </div>
            <!-- Sidebar -->
            <div id="sidebar" class="col-lg-2 col-lg-offset-10"></div>
        </div>
    </div>
    <!-- End Content -->

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.10.2.min.js"><\/script>')</script>
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.2/jquery-ui.min.js"></script>
    <script>window.jQuery.Widget || document.write('<script src="js/vendor/jquery-ui-1.10.2.min.js"><\/script>')</script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="assets/js/ie10-viewport-bug-workaround.js"></script>
    <script src="js/vendor/tag-it.min.js"></script>
    <script src="js/vendor/imagesloaded.pkgd.min.js"></script>
    <script src="js/vendor/masonry.pkgd.min.js"></script>
    <script src="js/vendor/jquery-ias.min.js"></script>
    <script src="js/vendor/jquery.colorbox-min.js"></script>

    <script src="js/plugins.js"></script>
    <script src="js/main.js"></script>
    <script src="js/collra/api.js"></script>
    <script src="js/collra/loader.js"></script>

    <script type="text/javascript">

        var collra = new collraApi();

        function initColorbox() {
            $(".grid-item-photo > a").colorbox({
                width: "90%",
                height: "90%",
                fixed: true,
                inline: true,
                onOpen: function () {
                    //$('#cboxLoadedContent .grid-item').removeAttr('style');
                }
            });
        }

        $("#nav").render('/template/header', null, function () {

            // init tagit
            $("#searchInputs").tagit({
                placeholderText: 'Search for...',
                allowSpaces: true,
                availableTags: collra.getAvailableTags()
            });

            // submit action
            //$('#searchForm').on('submit', function (e) {
            //    e.preventDefault();

            //}).submit();

        });

        $("#list").render('/template/item', collra.search($("#searchInputs").val()), function () {

            //console.log($("#searchInputs").val())

            // initialize Masonry
            var $container = $('#collra_result');

            $container.masonry({
                itemSelector: '.grid-item',
                isFitWidth: true
            });

            // layout Masonry again after all images have loaded
            $container.imagesLoaded(function () {
                $container.masonry();
            });

            // colorbox
            initColorbox();

            var ias = $.ias({
                container: ".grid",
                item: ".grid-item",
                pagination: ".pager",
                next: "a",
                delay: 1200
            });

            ias.on('render', function (newElements) {
                $(newElements).css({ opacity: 0 });
            });

            ias.on('rendered', function (newElements) {
                // hide new items while they are loading
                var $newElems = $(newElements);//.css({ opacity: 0 });
                // ensure that images load before adding to masonry layout
                $newElems.imagesLoaded(function () {
                    // show elems now they're ready
                    $newElems.animate({ opacity: 1 });
                    $container.masonry('appended', $newElems, true);
                    initColorbox();
                });
            });

            ias.extension(new IASSpinnerExtension({
                src: 'img/loading.gif',
                html: '<div class="ias-spinner" style=""><img src="{src}" alt="Loading..."><div><em>Loading next items...</em></div></div>'
            }));
            ias.extension(new IASNoneLeftExtension({
                html: '<div class="ias-noneleft" style="text-align:center"><p><em>You reached the end!</em></p></div>'
            }));

        });

        $("#sidebar").render('/template/sidebar');

    </script>

    <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
    <script>
        (function (b, o, i, l, e, r) {
            b.GoogleAnalyticsObject = l; b[l] || (b[l] =
            function () { (b[l].q = b[l].q || []).push(arguments) }); b[l].l = +new Date;
            e = o.createElement(i); r = o.getElementsByTagName(i)[0];
            e.src = '//www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e, r)
        }(window, document, 'script', 'ga'));
        ga('create', 'UA-XXXXX-X'); ga('send', 'pageview');
    </script>
</body>
</html>
